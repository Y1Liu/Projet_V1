<!DOCTYPE html>
<html>
<head>
<link href="{{ url_for('static', filename='style/style.css') }}" rel="stylesheet" type="text/css"/>
<link href="//netdna.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<link href="https://fonts.googleapis.com/css?family=Muli" rel="stylesheet">
<script src="//netdna.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
<!------ Include the above in your HEAD tag ---------->
<link href="//netdna.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<script src="//netdna.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
<!------ Include the above in your HEAD tag ---------->
<meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">-->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/themes/base/jquery-ui.css">
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-tokenfield/0.12.0/css/tokenfield-typeahead.css">
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-tokenfield/0.12.0/css/bootstrap-tokenfield.css">
  <!--<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.css">-->
  <script src="vendor/jquery/jquery-1.11.2.min.js"></script>
  <script src="vendor/typeahead/typeahead.js"></script>
  <script src="vendor/tagsinput/bootstrap-tagsinput.js"></script>
</head>
<body>
<div class="carousel fade-carousel slide" data-ride="carousel" data-interval="4000" id="bs-carousel">
  <!-- Overlay -->
  <div class="overlay"></div>
  <!-- Indicators -->
  <ol class="carousel-indicators">
    <li data-target="#bs-carousel" data-slide-to="0" class="active"></li>
    <li data-target="#bs-carousel" data-slide-to="1"></li>
  </ol>
  <!-- Wrapper for slides -->
  <div class="carousel-inner">
    <div class="item slides active">
      <div class="slide-1"></div>
      <div class="hero">
        <hgroup>
            <h1>Découvrez</h1>        
            <h3>Découvrez de nouvelles villes qui vous ressemblent à partir de recommandations personnalisées</h3>
        </hgroup>
        <br />
        <br />
        <a class="scroll" href="#parent"><b>Démarrez dès maintenant</b></a>
      </div>
    </div>
    <div class="item slides">
      <div class="slide-2"></div>
      <div class="hero">        
        <hgroup>
            <h1>Planifiez</h1>        
            <h3>Planifiez un trajet correspondant à vos attentes et respectant vos contraintes</h3>
        </hgroup>  
        <br />    
        <br /> 
        <a class="scroll" href="#parent"><b>Démarrez dès maintenant</b></a>
      </div>
    </div>
  </div> 
</div>


<div id="parent">
<div class="container">
  <br />
  <br />
  <form class="form-horizontal" action="" role="form">
    <div class="form-group">
      <label class="control-label col-sm-2" for="email">Adresse de départ(*)</label>
      <div class="col-sm-10">
        <input type="text" class="form-control" id="depart" name="depart" method="get" placeholder="Gare de Lyon, Paris" required>
      </div>
    </div>

    <div class="form-group">
      <label class="control-label col-sm-2" for="pwd">Jour du départ(*)</label>
      <div class="col-sm-10">          
        <input type="date" class="form-control" id="date_dep" name="date_dep" method="get" >
      </div>
    </div>
	<div class="form-group">
      <label class="control-label col-sm-2" for="pwd">Heure du départ(*)</label>
      <div class="col-sm-10">          
        <input type="time" class="form-control" id="time_dep" name="time_dep" method="get" >
      </div>
    </div>
	<div class="form-group">
      <label class="control-label col-sm-2" for="email">Adresse d'arrivée(*)</label>
      <div class="col-sm-10">
        
        <input type="text" class="form-control" id="arrivee" name="arrivee" method="get" placeholder="Vieux Port, Marseille" required>
        
      </div>
    </div>
	<div class="form-group">
      <label class="control-label col-sm-2" for="pwd">Jour d'arrivée(*)</label>
      <div class="col-sm-10">          
        <input type="date" class="form-control" id="date_arr" name="date_arr" method="get" >
      </div>
    </div>
	<div class="form-group">
      <label class="control-label col-sm-2" for="pwd">Heure d'arrivée(*)</label>
      <div class="col-sm-10">          
        <input type="time" class="form-control" id="time_arr" name=time_arr" method="get">
      </div>
    </div>

  <div class="form-group">
      <label class="control-label col-sm-2" for="email">Escales</label>
      <div class="col-sm-10">
    <input type="text" class="form-control" id="escales" name="escales" method="get" placeholder="Entrez vos escales"/>
  </div>
</div>
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/typeahead.js/0.10.1/typeahead.bundle.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-tokenfield/0.12.0/bootstrap-tokenfield.js"></script>

    	<div class="form-group">
      <label class="control-label col-sm-2" for="email">Tags(*)</label>
      <div class="col-sm-10">
		<input type="text" class="form-control" id="tags" name="tags" method="get" value="Rock,Art,Museum" />

    <script type="text/javascript" src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/typeahead.js/0.10.1/typeahead.bundle.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-tokenfield/0.12.0/bootstrap-tokenfield.js"></script>
</div>
</div>
    <br />
    <div class="form-group">
      <label class="control-label col-sm-2" for="email">Moyen de transport(*)</label>
      <div class="col-sm-10">
	   <button type="button" class="btn btn-default">Voiture</button>
	   <button type="button" class="btn btn-default">Transports en commun</button>
	   <button type="button" class="btn btn-default">A pied</button>
	</div>
</div>
   <div class="form-group">
      <label class="control-label col-sm-2" for="email">Durée maximale de trajet sans pause(*)</label>
      <div class="col-sm-10">
	   <button type="button" class="btn btn-default">1 h</button>
	   <button type="button" class="btn btn-default">2 h</button>
	   <button type="button" class="btn btn-default">3 h</button>
	   <button type="button" class="btn btn-default">4 h</button>
	</div>
</div>
	   <div class="form-group">
    <label class="control-label col-sm-2" for="email">Durée maximale du repas(*)</label>
      <div class="col-sm-10">
	   <button type="button" class="btn btn-default">15 min</button>
	   <button type="button" class="btn btn-default">30 min</button>
	   <button type="button" class="btn btn-default">45 min</button>
	   <button type="button" class="btn btn-default">1 h</button>
	   <button type="button" class="btn btn-default">1 h 30</button>
	</div>
</div>
   <div class="form-group">
      <label class="control-label col-sm-2" for="email">Optimisation(*)</label>
      <div class="col-sm-10">
	   <button type="button" class="btn btn-default">Distance</button>
	   <button type="button" class="btn btn-default">Temps</button>
	   <button type="button" class="btn btn-default">Affinité</button>
	</div>
</div>
	<br />
	<div class="form-group">        
      <div class="col-sm-offset-2 col-sm-10">
		<a class="goToMap" href="#map">
        <button type="submit" id="submit" onClick="#map" style="color: #f5f5f5; background-color: #1abc9c; border-color: #1abc9c; border-radius: 5px; padding: 5px;">Soumettre</button></a>
      </div>
    </div>
  </form>
</div>
</div>

<div id="wrapper">
  <!-- Sidebar -->
  <div id="sidebar-wrapper">
    <ul class="sidebar-nav" id="side_bar">
      <li class="sidebar-brand" style="font-weight: bold; color: #1abc9c;">
    	<p style="color: #1abc9c;"> test </p>
      </li>
      <hr>
    </ul>
  </div>
  <!-- /#sidebar-wrapper -->
  <!-- Page Content -->
  <div id="page-content-wrapper">
    <div class="container-fluid">
      <div class="row">
        <div class="col-lg-12">
          <h1>
	    <a href="#menu-toggle" class="gradient-menu" id="menu-toggle"></a>
          &nbsp;Informations trajet&nbsp;<!-- a href="#menu-toggle" class="btn btn-default" >Toggle Sidebar</a -->
          </h1>
          <!-- you can use tables or divs for the overall layout -->
          <div id="map"></div>
        </div>
      </div>
    </div>
  </div>
  <!-- /#page-content-wrapper -->
</div>

<script type="text/javascript">
var engine = new Bloodhound({
  local: [{value: 'red'}, {value: 'blue'}, {value: 'green'} , {value: 'yellow'}, {value: 'violet'}, {value: 'brown'}, {value: 'purple'}, {value: 'black'}, {value: 'white'}],
  datumTokenizer: function(d) {
	return Bloodhound.tokenizers.whitespace(d.value);
  },
  queryTokenizer: Bloodhound.tokenizers.whitespace
});

engine.initialize();

$('#escales').tokenfield({
  typeahead: [null, { source: engine.ttAdapter() }]
});

$('#tags').tokenfield({
  autocomplete: {
	source: ['Cinema','Multiplex', 'Movie','Film','History','Museum', 'Art','Sport','Bar', 'Site', 'Concert', 'Music', 'Plaza', 'Hall', 'Gallery', 'Stadium', 'Bowling', 'School', 'Zoo','Park', 'Arts'],
	delay: 100,
  },
  showAutocompleteOnFocus: true
})
  // Select all links with hashes
$('a[href*="#"]')
  // Remove links that don't actually link to anything
  .not('[href="#"]')
  .not('[href="#0"]')
  .click(function(event) {
    // On-page links
    if (
      location.pathname.replace(/^\//, '') == this.pathname.replace(/^\//, '') 
      && 
      location.hostname == this.hostname
    ) {
      // Figure out element to scroll to
      var target = $(this.hash);
      target = target.length ? target : $('[name=' + this.hash.slice(1) + ']');
      // Does a scroll target exist?
      if (target.length) {
        // Only prevent default if animation is actually gonna happen
        event.preventDefault();
        $('html, body').animate({
          scrollTop: target.offset().top
        }, 700, function() {
          // Callback after animation
          // Must change focus!
          var $target = $(target);
          $target.focus();
          if ($target.is(":focus")) { // Checking if the target was focused
            return false;
          } else {
            $target.attr('tabindex','-1'); // Adding tabindex for elements not focusable
            $target.focus(); // Set focus again
          };
        });
      }
    }
  }); 
// on crée un tableau avec tous les points du voyage du départ à l'arrivee avec toutes les escales 
var urlParams;
(window.onpopstate = function () {
    var match,
        pl     = /\+/g,  // Regex for replacing addition symbol with a space
        search = /([^&=]+)=?([^&]*)/g,
        decode = function (s) { return decodeURIComponent(s.replace(pl, " ")); },
        query  = window.location.search.substring(1);

    urlParams = {};
    while (match = search.exec(query))
       urlParams[decode(match[1])] = decode(match[2]);
})();

var esca=[];
var dep = urlParams["depart"];
var arr = urlParams["arrivee"];
var esc = urlParams["escales"],
  wordArray = esc.split(',');

var voyage=[dep];
for (var i=0; i<esc.length;i++) {
  voyage.push(wordArray[i])
}
voyage.push(arr); 

// Récupération des tags sous forme de tableau
var tag = urlParams["tags"],
	tags = tag.split(',');

var heure_dep = urlParams["time_dep"],
	dep_time = heure_dep.split(',');
var date_dep = urlParams["date_dep"];


var data = {
	Depart: dep,
	depart_heure: dep_time,
	depart_jour: date_dep,
	Arrivee: arr,
	Escales: wordArray,
	tags_users: tags
}


     $('#submit').click(function() {
        $.ajax({
          type: "POST",
          contentType: "application/json;charset=utf-8",
          url: "/test",
          traditional: "true",
          data: JSON.stringify(data),
          dataType: "json"
          });
		
    });

var recom = {{ test|tojson }};

function initMap() {

		var myWrapper = $("#wrapper");
		  $("#menu-toggle").click(function(e) {
		    e.preventDefault();
		    $("#wrapper").toggleClass("toggled");
		    myWrapper.one('webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend', function(e) {
		      // code to execute after transition ends
		      google.maps.event.trigger(map, 'resize');
		    });
		  });

        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 4,
          //center: ('Amiens, France')
        });
        
        var directionsService = new google.maps.DirectionsService;
        var directionsDisplay = new google.maps.DirectionsRenderer({
          draggable: true,
          map: map,
          panel: document.getElementById('right-panel'),
          suppressMarkers : false
        });
  
        directionsDisplay.addListener('directions_changed', function() {
        });

        displayRoute(dep, arr, directionsService,
            directionsDisplay);
                
}
      function displayRoute(origin, destination, service, display) {
          var waypts=[];
          for (var i = 0; i < wordArray.length ; i++) { 
            if (!wordArray[i]) {
                // si l'escale n'existe pas on n'ajoute rien a waypts
                waypts=waypts;
            } else {
                waypts.push({
                    location: wordArray[i]
                });
            }         
          }
          for (var i = 0; i < recom.length ; i++) { 
            if (!recom[i][0]) {
                // si l'escale n'existe pas on n'ajoute rien a waypts
                waypts=waypts;
            } else {
                waypts.push({
                    location: recom[i][0]
                });
            }         
          } 
        service.route({
          origin: origin,
          destination: destination,
          waypoints: waypts,
          travelMode: 'DRIVING',
          avoidTolls: true,
          optimizeWaypoints: true
        }, function(response, status) {
          if (status === 'OK') {
            display.setDirections(response);
          } else {
            alert('Could not display directions due to: ' + status);
          }
        });
      }
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB8pxsl2jFQSwshMT2I5Weue8CKLgxalY8&callback=initMap">
    </script>
    <div class="footer">
  		<p>
		<img src="{{ url_for('static', filename='img/logo.png') }}" alt="Italian Trulli" style="width:30px;height:30px;">
		Copyright © SmartPlanner - Tous droits réservés
		</p>
	</div>
  </body>

</html>