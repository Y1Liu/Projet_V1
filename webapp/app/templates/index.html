<!DOCTYPE html>
<html>
<head>
<link href="{{ url_for('static', filename='style/style.css') }}" rel="stylesheet" type="text/css"/>
<link href="//netdna.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<link href="https://fonts.googleapis.com/css?family=Muli" rel="stylesheet">
<script src="//netdna.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
<!------ Include the above in your HEAD tag ---------->
<link href="//netdna.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<script src="//netdna.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
<!------ Include the above in your HEAD tag ---------->
<meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">-->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/themes/base/jquery-ui.css">
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-tokenfield/0.12.0/css/tokenfield-typeahead.css">
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-tokenfield/0.12.0/css/bootstrap-tokenfield.css">
  <!--<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.css">-->
  <script src="vendor/jquery/jquery-1.11.2.min.js"></script>
  <script src="vendor/typeahead/typeahead.js"></script>
  <script src="vendor/tagsinput/bootstrap-tagsinput.js"></script>
  
  <style>
  
input[type="checkbox"]:not(:checked), 
input[type="checkbox"]:checked {
  position: absolute;
  left: -9999%;
}

input[type="checkbox"] + label {
  display: inline-block;
  padding: 10px;
  cursor: pointer;
  border: none;
  border-radius: 8px;
  color: black;
  background-color: white;
  margin-bottom: 0px;
  font-weight: 100;
}

input[type="checkbox"]:checked + label {
  border: 1px solid #1abc9c;
  color: white;
  background-color: #1abc9c;
}

.btn {
  padding: 0;
  margin-top: -0.7%;
  clear: both;
}

.checkbox {
  list-style-type: none;
  list-style-position: outside;
  padding: 1px;
  float: left;
  margin-right: 5px;
}
</style>
  
</head>
<body>

<!-- Création du carousel d'accueil -->
<div class="carousel fade-carousel slide" data-ride="carousel" data-interval="4000" id="bs-carousel">
  <!-- Overlay -->
  <div class="overlay"></div>
  <!-- Indicators -->
  <ol class="carousel-indicators">
    <li data-target="#bs-carousel" data-slide-to="0" class="active"></li>
    <li data-target="#bs-carousel" data-slide-to="1"></li>
  </ol>
  <!-- Wrapper for slides -->
  <div class="carousel-inner">
    <div class="item slides active">
      <div class="slide-1"></div>
      <div class="hero">
        <hgroup>
            <h1>Découvrez</h1>        
            <h3>Découvrez de nouvelles villes qui vous ressemblent à partir de recommandations personnalisées</h3>
        </hgroup>
        <br />
        <br />
        <a class="scroll" href="#parent"><b>Démarrez dès maintenant</b></a>
      </div>
    </div>
    <div class="item slides">
      <div class="slide-2"></div>
      <div class="hero">        
        <hgroup>
            <h1>Planifiez</h1>        
            <h3>Planifiez un trajet correspondant à vos attentes et respectant vos contraintes</h3>
        </hgroup>  
        <br />    
        <br /> 
        <a class="scroll" href="#parent"><b>Démarrez dès maintenant</b></a>
      </div>
    </div>
  </div> 
</div>

<!-- Création du formulaire de renseignement -->
<div id="parent">
<div class="container" style="margin-top: 5%;">
  <br />
  <br />
  <form class="form-horizontal" action="#map" role="form" id="form">
    <div class="form-group">
      <label class="control-label col-sm-2" for="email">Adresse de départ(*)</label>
      <div class="col-sm-10">
        <input type="text" class="form-control" id="depart" name="depart" method="post" placeholder="Gare de Lyon, Paris" required>
      </div>
    </div>

    <div class="form-group">
      <label class="control-label col-sm-2" for="pwd">Jour du départ</label>
      <div class="col-sm-10">          
        <input type="date" class="form-control" id="date_dep" name="date_dep" method="post" >
      </div>
    </div>
	<div class="form-group">
      <label class="control-label col-sm-2" for="pwd">Heure du départ</label>
      <div class="col-sm-10">          
        <input type="time" class="form-control" id="time_dep" name="time_dep" method="post" >
      </div>
    </div>
	<div class="form-group">
      <label class="control-label col-sm-2" for="email">Adresse d'arrivée(*)</label>
      <div class="col-sm-10">
        
        <input type="text" class="form-control" id="arrivee" name="arrivee" method="post" placeholder="Vieux Port, Marseille" required>
        
      </div>
    </div>
	<div class="form-group">
      <label class="control-label col-sm-2" for="pwd">Jour d'arrivée</label>
      <div class="col-sm-10">          
        <input type="date" class="form-control" id="date_arr" name="date_arr" method="post" >
      </div>
    </div>
    
     <div id="loadingGif" style="display:none; position: absolute; margin-top: 0px; margin-left: 480px; z-index:900;"><img src="../static/img/logo.gif" style=" border-radius: 30px; height: 140%; width: 140%;"></div>
     
	<div class="form-group">
      <label class="control-label col-sm-2" for="pwd">Heure d'arrivée</label>
      <div class="col-sm-10">          
        <input type="time" class="form-control" id="time_arr" name=time_arr" method="post">
      </div>
    </div>

  <div class="form-group">
      <label class="control-label col-sm-2" for="email">Escales</label>
      <div class="col-sm-10">
    <input type="text" class="form-control" id="escales" name="escales" method="post" placeholder="Entrez vos escales"/>
  </div>
</div>
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/typeahead.js/0.10.1/typeahead.bundle.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-tokenfield/0.12.0/bootstrap-tokenfield.js"></script>
    <script type="text/javascript">
    </script>
    	<div class="form-group">
      <label class="control-label col-sm-2" for="email">Tags(*)</label>
      <div class="col-sm-10" style="padding-bottom">
		<input type="text" class="form-control" id="tags" name="tags" method="post" placeholder="Entrez vos tags de préférences" />

    <script type="text/javascript" src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/typeahead.js/0.10.1/typeahead.bundle.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-tokenfield/0.12.0/bootstrap-tokenfield.js"></script>
    <script type="text/javascript">
    </script>
</div>
</div>
    <br />
    <div class="form-group" data-toogle="buttons">
      <label class="control-label col-sm-2" for="email">Moyen de transport(*)</label>
      <div class="col-sm-10">
      <ul class="btn">
      <li class="checkbox">
    	   <input type="checkbox" method="post" id="transport_voiture" name="transport" value="driving">
    	   <label for="transport_voiture">Voiture</label>
    	   </li>
    	   <li class="checkbox">
    	   <input type="checkbox" method="post" id="transport_en_commun" name="transport" value="transit">
	       <label for="transport_en_commun">Transport en commun</label>
	       </li>
	       <li class="checkbox">
    	   <input type="checkbox" method="post" id="transport_walking" name="transport" value="walking">
	      <label for="transport_walking">A pied</label>
	      </li>
	      </ul>
	</div>
</div>
   <div class="form-group">
      <label class="control-label col-sm-2" for="email">Durée maximale de trajet sans pause</label>
      <div class="col-sm-10">
      <ul class="btn">
      <li class="checkbox">
    	   <input type="checkbox" method="post" id="no_pause" name="tps_max_trajet" value=0>
    	   <label for="no_pause">Sans pause</label>
    	   </li>
    	   <li class="checkbox">
    	   <input type="checkbox" method="post" id="pause_1h" name="tps_max_trajet" value=3600>
	       <label for="pause_1h">1 h</label>
	       </li>
	       <li class="checkbox">
    	   <input type="checkbox" method="post" id="pause_2h" name="tps_max_trajet" value=7200>
	      <label for="pause_2h">2 h</label>
	      </li>
	       <li class="checkbox">
    	   <input type="checkbox" method="post" id="pause_3h" name="tps_max_trajet" value=10800>
	      <label for="pause_3h">3 h</label>
	      </li>
	       <li class="checkbox">
    	   <input type="checkbox" method="post" id="pause_4h" name="tps_max_trajet" value=14400>
	      <label for="pause_4h">4 h</label>
	      </li>
	      </ul>
	</div>
</div>
	 <div class="form-group">
    <label class="control-label col-sm-2" for="email">Durée maximale du repas</label>
      <div class="col-sm-10">
      <ul class="btn">
      <li class="checkbox">
    	   <input type="checkbox" method="post" id="repas_15min" name="tps_repas" value="900">
    	   <label for="repas_15min">15 min</label>
    	   </li>
    	   <li class="checkbox">
    	   <input type="checkbox" method="post" id="repas_30min" name="tps_repas" value="1800">
	       <label for="repas_30min">30 min</label>
	       </li>
	       <li class="checkbox">
    	   <input type="checkbox" method="post" id="repas_45min" name="tps_repas" value="2700">
	      <label for="repas_45min">45 min</label>
	      </li>
	       <li class="checkbox">
    	   <input type="checkbox" method="post" id="repas_1h" name="tps_repas" value="3600">
	      <label for="repas_1h">1 h</label>
	      </li>
	       <li class="checkbox">
    	   <input type="checkbox" method="post" id="repas_1h30" name="tps_repas" value="4400">
	      <label for="repas_1h30">1 h 30</label>
	      </li>
	      </ul>
	</div>
</div>
   <div class="form-group">
      <label class="control-label col-sm-2" for="email">Optimisation(*)</label>
      <div class="col-sm-10">
      <ul class="btn">
      <li class="checkbox">
    	   <input type="checkbox" method="post" id="optimisation_distance" name="optimisation" value="distance">
    	   <label for="optimisation_distance">Distance</label>
    	   </li>
    	   <li class="checkbox">
    	   <input type="checkbox" method="post" id="optimisation_time" name="optimisation" value="time">
	       <label for="optimisation_time">Temps</label>
	       </li>
	       <li class="checkbox">
    	   <input type="checkbox" method="post" id="optimisation_affinity" name="optimisation" value="affinity">
	      <label for="optimisation_affinity">Affinité</label>
	      </li>
	      </ul>
    	</div>
	</div>

	<br />
	<div class="form-group">        
      <div class="col-sm-offset-2 col-sm-10">
        <button type="submit" id="submit" style="color: #f5f5f5; background-color: #1abc9c; border-color: #1abc9c; border-radius: 5px; padding: 5px;" onclick="gototab()">Soumettre</button>
      </div>
    </div>
  </form>
</div>
</div>

<!-- Affichage de la carte -->

  <!-- /#sidebar-wrapper -->
  <!-- Page Content -->
  <div id="page-content-wrapper">
    <div class="container-fluid">
      <div class="row">
        <div class="col-lg-12">
          <h1>
	    <a href="#menu-toggle" class="gradient-menu" id="menu-toggle"></a>
          &nbsp;Map&nbsp;<!-- a href="#menu-toggle" class="btn btn-default" >Toggle Sidebar</a -->
          </h1>
          <!-- you can use tables or divs for the overall layout -->
          <div id="map"></div>
        </div>
      </div>
    </div>
  </div>
  <!-- /#page-content-wrapper -->
</div>

<!-- /#wrapper -->
<script type="text/javascript">

function gototab() {
  document.getElementById('loadingGif').style.display = "block";
  setTimeout(function() {
    document.getElementById('loadingGif').style.display = "none";
    document.getElementById('map').style.display = "block";
    },30000);  
}

function gotomap() {
$('html, body').animate({
        scrollTop: $('#map').offset().top
    }, 'slow');
document.getElementById('loadingGif').style.display = "none";
}

 </script>
 
<script type="text/javascript">
$("input:checkbox").on('click', function() {
  // in the handler, 'this' refers to the box clicked on
  var $box = $(this);
  if ($box.is(":checked")) {
    // the name of the box is retrieved using the .attr() method
    // as it is assumed and expected to be immutable
    var group = "input:checkbox[name='" + $box.attr("name") + "']";
    // the checked state of the group/box on the other hand will change
    // and the current value is retrieved using .prop() method
    $(group).prop("checked", false);
    $box.prop("checked", true);
  } else {
    $box.prop("checked", false);
  }
});
</script>
<script type="text/javascript">
var engine = new Bloodhound({
  local: [{value: 'red'}, {value: 'blue'}, {value: 'green'} , {value: 'yellow'}, {value: 'violet'}, {value: 'brown'}, {value: 'purple'}, {value: 'black'}, {value: 'white'}],
  datumTokenizer: function(d) {
	return Bloodhound.tokenizers.whitespace(d.value);
  },
  queryTokenizer: Bloodhound.tokenizers.whitespace
});

engine.initialize();

$('#escales').tokenfield({
typeahead: [null, { source: engine.ttAdapter() }]
});

$('#tags').tokenfield({
  autocomplete: {
	source: ['Cinema','Multiplex', 'Movie','Film','History','Museum', 'Art','Sport','Bar', 'Site', 'Concert', 'Music', 'Plaza', 'Hall', 'Gallery', 'Stadium', 'Bowling', 'School', 'Zoo','Park', 'Arts'],
	delay: 100,
  },
  showAutocompleteOnFocus: true
});
</script>

<script type="text/javascript">
// Fonction permettant de scroller
// Select all links with hashes
$('a[href*="#"]')
  // Remove links that don't actually link to anything
  .not('[href="#"]')
  .not('[href="#0"]')
  .click(function(event) {
    // On-page links
    if (
      location.pathname.replace(/^\//, '') == this.pathname.replace(/^\//, '') 
      && 
      location.hostname == this.hostname
    ) {
      // Figure out element to scroll to
      var target = $(this.hash);
      target = target.length ? target : $('[name=' + this.hash.slice(1) + ']');
      // Does a scroll target exist?
      if (target.length) {
        // Only prevent default if animation is actually gonna happen
        event.preventDefault();
        $('html, body').animate({
          scrollTop: target.offset().top
        }, 700, function() {
          // Callback after animation
          // Must change focus!
          var $target = $(target);
          $target.focus();
          if ($target.is(":focus")) { // Checking if the target was focused
            return false;
          } else {
            $target.attr('tabindex','-1'); // Adding tabindex for elements not focusable
            $target.focus(); // Set focus again
          };
        });
      }
    }
  }); 
</script>
  
<script type="text/javascript">
// fonction permettant de recuperer les termes contenus dans l'url 
var urlParams;
(window.onpopstate = function () {
    var match,
        pl     = /\+/g,  // Regex for replacing addition symbol with a space
        search = /([^&=]+)=?([^&]*)/g,
        decode = function (s) { return decodeURIComponent(s.replace(pl, " ")); },
        query  = window.location.search.substring(1);

    urlParams = {};
    while (match = search.exec(query))
       urlParams[decode(match[1])] = decode(match[2]);
})();


var esca=[];
var dep = urlParams["depart"];
var arr = urlParams["arrivee"];
var esc = urlParams["escales"],
  wordArray = esc.split(',');

var voyage=[dep];
for (var i=0; i < esc.length; i++) {
  voyage.push(wordArray[i])
}
voyage.push(arr); 

// Récupération des tags sous forme de tableau
var tag = urlParams["tags"],
	tags = tag.split(',');

/*var heure_dep = urlParams["time_dep"],
	dep_time = heure_dep.split(',');
var date_dep = urlParams["date_dep"];*/

var pause = urlParams["tps_max_trajet"];

var optimization = urlParams["optimisation"];

var mode = urlParams["transport"];


var data = {
	depart: dep,
	arrivee: arr,
	escales: wordArray,
	tags_users: tags,
	tps_max: pause,
	optimisation: optimization,
	transport: mode
}

$("form").submit(function(){
   $.ajax({
          type: "GET",
          contentType: "application/json;charset=utf-8",
          url: "/",
          traditional: "true",
          data: JSON.stringify(data),
          dataType: "json"
          });	
});


var recom = {{ test|tojson }};

</script>
<script type="text/javascript">
function initMap() {

		var myWrapper = $("#wrapper");
		  $("#menu-toggle").click(function(e) {
		    e.preventDefault();
		    $("#wrapper").toggleClass("toggled");
		    myWrapper.one('webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend', function(e) {
		      // code to execute after transition ends
		      google.maps.event.trigger(map, 'resize');
		    });
		  });

        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 4,
          //center: ('Amiens, France')
        });
        
        var directionsService = new google.maps.DirectionsService;
        var directionsDisplay = new google.maps.DirectionsRenderer({
          draggable: true,
          map: map,
          panel: document.getElementById('right-panel'),
          suppressMarkers : false
        });
  
        directionsDisplay.addListener('directions_changed', function() {
        });

        displayRoute(dep, arr, directionsService,
            directionsDisplay);
                
}
      function displayRoute(origin, destination, service, display) {
          var waypts=[];
          for (var i = 0; i < wordArray.length ; i++) { 
            if (!wordArray[i]) {
                // si l'escale n'existe pas on n'ajoute rien a waypts
                waypts=waypts;
            } else {
                waypts.push({
                    location: wordArray[i]
                });
            }         
          }
          for (var i = 0; i < recom.length ; i++) { 
            if (!recom[i][0]) {
                // si l'escale n'existe pas on n'ajoute rien a waypts
                waypts=waypts;
            } else {
                waypts.push({
                    location: recom[i][0]
                });
            }         
          }
 
        service.route({
          origin: origin,
          destination: destination,
          waypoints: waypts,
          travelMode: 'DRIVING',
          avoidTolls: true,
          optimizeWaypoints: true
        }, function(response, status) {
          if (status === 'OK') {
            display.setDirections(response);
            alert(recom)
          } else {
            alert('Could not display directions due to: ' + status);
          }
        });
      }
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB8pxsl2jFQSwshMT2I5Weue8CKLgxalY8&callback=initMap">
    </script>
    <div class="footer">
  		<p>
		<img src="{{ url_for('static', filename='img/logo.png') }}" alt="Italian Trulli" style="width:30px;height:30px;">
		Copyright © SmartPlanner - Tous droits réservés
		</p>
	</div>
  </body>

</html>